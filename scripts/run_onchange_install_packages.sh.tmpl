#!/bin/bash

# ------------------------------------------------------------------------------
# This hash comment is critical. Chezmoi checks the checksum of this file.
# If you add a package to this list, the file changes, and the script runs.
# PACKAGES: git, zsh, tmux, neovim, ripgrep, ghostty, xclip, fzf, psql, curl, starship
# ------------------------------------------------------------------------------

set -e # Exit immediately if a command fails

{{ if eq .chezmoi.os "darwin" }}
# ------------------------------------------------------------------------------
# macOS (Homebrew)
# ------------------------------------------------------------------------------

echo "Detected macOS. Checking Homebrew..."

# 1. Install Homebrew if it's missing
if ! command -v brew &> /dev/null; then
 echo "Homebrew not found. Installing..."
 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# 2. Install Packages
echo "Installing/Updating macOS packages..."
brew bundle --no-lock --file=/dev/stdin <<EOF
brew "git"
brew "zsh"
brew "tmux"
brew "neovim"
brew "ripgrep"
brew "fzf"
brew "curl"
brew "libpq"
cash "ghostty"
cash "starship"
EOF

{{ else if eq .chezmoi.os "linux" -}}

# ------------------------------------------------------------------------------
# Linux (Ubuntu/Debian)
# ------------------------------------------------------------------------------
echo "Detected Linux. Updating apt..."

sudo apt update

echo "Installing Linux packages..."
sudo apt install -y git curl zsh tmux neovim vim-gtk3 ripgrep fzf postgresql-client xclip build-essential

# Install Ghostty on Ubuntu/Debian
if ! command -v ghostty &> /dev/null; then
	cd /tmp || exit 1
	/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/mkasberg/ghostty-ubuntu/HEAD/install.sh)"
else
	echo "âœ… Ghostty is already installed."
fi

# Install Starship
if ! command -v starship &> /dev/null; then
	curl -fsSL https://starship.rs/install.sh | sh -s -- -y
else
	echo "âœ… Starship is already installed."
fi


{{ end -}}

echo #ðŸŽ‰ Package installation complete!"
